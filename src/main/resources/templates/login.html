<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In - Golden Palm Hotel</title>

    <!-- Bootstrap + Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Your global theme CSS (provides the CSS variables) -->
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css">

    <style>
        /* ===== Login Page (safe fallbacks for variables) ===== */
        .login-wrapper{
            min-height:100vh;
            background: var(--gradient-dark, #0a0a0a);
            position:relative;
            overflow:hidden;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:2rem 1rem;
        }
        .login-wrapper::before{
            content:'';
            position:absolute; inset:0;
            background:
                    radial-gradient(circle at 20% 30%, rgba(255,215,0,.15) 0%, transparent 50%),
                    radial-gradient(circle at 80% 70%, rgba(255,215,0,.1) 0%, transparent 50%),
                    url('data:image/svg+xml,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="%23ffd700" fill-opacity="0.03"><circle cx="30" cy="30" r="1"/></g></svg>');
        }
        .login-container{ position:relative; z-index:1; width:100%; max-width:500px; }

        .login-card{
            width:100%;
            background: var(--gradient-card, linear-gradient(135deg,#141414,#1f1f1f));
            border:1px solid var(--border-primary, #262626);
            border-radius: var(--radius-2xl, 1.5rem);
            box-shadow: var(--shadow-2xl, 0 25px 50px -12px rgba(0,0,0,.5));
            position:relative; overflow:hidden; backdrop-filter: blur(20px);
        }
        .login-card::before{
            content:''; position:absolute; left:0; right:0; top:0; height:3px;
            background: var(--gradient-primary, linear-gradient(135deg,#ffd700,#ffed4a,#d4af37));
        }

        .login-header{ text-align:center; padding:3rem 2rem 2rem; }
        .login-header h1{
            font-size:2.5rem; font-weight:700;
            background: var(--gradient-primary, linear-gradient(135deg,#ffd700,#ffed4a,#d4af37));
            -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
            margin-bottom:1rem;
        }
        .login-header p{ color:var(--text-secondary, #a1a1aa); font-size:1.1rem; margin:0; }

        .login-body{ padding:0 2rem 2rem; }

        .form-floating{ margin-bottom:1.25rem; position:relative; }
        .form-floating .form-control{
            height:60px; padding:1rem;
            background: var(--bg-card, #141414);
            border:2px solid var(--border-primary, #262626);
            border-radius:16px; color:var(--text-primary, #fff);
            font-size:1rem; font-weight:500;
            transition: all .3s cubic-bezier(.4,0,.2,1);
            width:100%;
        }
        .form-floating .form-control:focus{
            border-color: var(--accent-primary, #ffd700);
            box-shadow: 0 0 0 4px var(--accent-light, rgba(255,215,0,.2));
            background: var(--bg-card-hover, #1f1f1f);
            outline:none;
        }
        .form-floating label{
            color:var(--text-muted, #71717a);
            font-size:1rem; font-weight:500; padding:1rem; left:0; top:0;
        }
        .form-floating .form-control:focus + label,
        .form-floating .form-control:not(:placeholder-shown) + label{
            color: var(--accent-primary, #ffd700);
            transform: scale(.85) translateY(-.5rem) translateX(.15rem);
        }

        /* Eye button stays inside password field */
        .password-toggle{
            position:absolute; right:1rem; top:50%; transform:translateY(-50%);
            background:none; border:none; color:var(--text-muted,#9ca3af); cursor:pointer;
            padding:.5rem; border-radius:8px; transition: all .3s ease; z-index:10; font-size:1.1rem;
        }
        .password-toggle:hover{ color:var(--accent-primary,#ffd700); background: rgba(255,215,0,.1); }

        .remember-me{
            display:flex; align-items:center; gap:.75rem; margin: .75rem 0 1.5rem;
        }
        .remember-me input[type="checkbox"]{ width:20px; height:20px; accent-color: var(--accent-primary,#ffd700); cursor:pointer; }
        .remember-me label{ color:var(--text-secondary,#a1a1aa); margin:0; user-select:none; }

        .login-btn{
            width:100%; height:60px; padding:0 2rem; font-size:1.1rem; font-weight:700;
            text-transform:uppercase; letter-spacing:1px; border-radius:16px;
            background: var(--gradient-primary, linear-gradient(135deg,#ffd700,#ffed4a,#d4af37));
            color: var(--bg-primary, #0a0a0a); border:none; position:relative; overflow:hidden;
            transition: all .3s cubic-bezier(.4,0,.2,1); margin-bottom:1.5rem;
            display:flex; align-items:center; justify-content:center; gap:.5rem; cursor:pointer;
        }
        .login-btn:hover{ transform: translateY(-2px); box-shadow: var(--shadow-lg, 0 10px 15px -3px rgba(0,0,0,.4)), 0 0 30px rgba(255,215,0,.4); }
        .login-btn:active{ transform: scale(.98); }
        .login-btn::before{
            content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
            transition:left .6s cubic-bezier(.4,0,.2,1);
        }
        .login-btn:hover::before{ left:100%; }

        .register-link{ text-align:center; padding-top:1.25rem; border-top:1px solid var(--border-primary,#262626); }
        .register-link p{ color:var(--text-secondary,#a1a1aa); margin:0; line-height:1.6; }
        .register-link a{ color:var(--accent-primary,#ffd700); text-decoration:none; font-weight:600; }
        .register-link a:hover{ color:var(--accent-secondary,#ffed4a); text-decoration:underline; }

        /* Fixed top-left/back & top-right/staff links to prevent overlap */
        .back-to-home{
            position: fixed;
            top: var(--space-6, 24px);
            left: var(--space-6, 24px);
            z-index: 1000;
        }
        .back-btn{
            display:inline-flex; align-items:center; gap:.5rem; padding:.5rem 1rem;
            background: var(--accent-light, rgba(255,215,0,.1));
            color: var(--accent-primary,#ffd700); text-decoration:none;
            border-radius: var(--radius-lg, 10px); font-size:.875rem; font-weight:600;
            border:1px solid var(--border-accent, rgba(255,215,0,.2)); backdrop-filter: blur(10px);
            transition: all .3s ease;
        }
        .back-btn:hover{ background: rgba(255,215,0,.2); transform: translateX(-3px); }

        .switch-portal{
            position: fixed;
            top: var(--space-6, 24px);
            right: var(--space-6, 24px);
            z-index: 1000;
        }
        .switch-portal a{
            display:inline-flex; align-items:center; gap:.5rem; padding:.5rem 1rem;
            background: var(--accent-light, rgba(255,215,0,.1));
            color: var(--text-primary, #fff); text-decoration:none;
            border-radius: var(--radius-lg, 10px); font-size:.875rem; font-weight:700;
            border:1px solid var(--border-accent, rgba(255,215,0,.2)); transition: all .3s ease;
        }
        .switch-portal a:hover{ background: rgba(255,215,0,.2); }

        /* Defensive rule: if a link ever ends up inside a field row, neutralize positioning */
        .form-floating .switch-portal,
        .form-floating .register-link a,
        .form-floating a.staff-login{
            position: static !important; display:inline !important; margin:0 !important;
        }

        /* Alerts */
        .alert-modern{
            border:none; border-radius: var(--radius-xl, 1rem);
            padding: 1rem 1.25rem; margin-bottom: 1rem; font-weight:500;
            display:flex; align-items:center; gap:.75rem;
        }
        .alert-success-modern{ background: rgba(34,197,94,.1); color:#4ade80; border-left:4px solid #22c55e; }
        .alert-error-modern{ background: rgba(239,68,68,.1); color:#f87171; border-left:4px solid #ef4444; }

        @media (max-width:768px){
            .login-card{ margin:1rem; max-width:none; }
            .login-header, .login-body{ padding-left:1.25rem; padding-right:1.25rem; }
        }
    </style>
</head>
<body>

<!-- Fixed top-right: Staff/Admin portal link -->
<div class="switch-portal">
    <a href="/admin/login">
        <i class="fas fa-id-card"></i><span>Staff/Admin Login</span>
    </a>
</div>

<!-- Fixed top-left: Back to home -->
<div class="back-to-home">
    <a href="/" class="back-btn">
        <i class="fas fa-arrow-left"></i><span>Back to Home</span>
    </a>
</div>

<div class="login-wrapper">
    <div class="login-container">
        <div class="login-card">
            <!-- Header -->
            <div class="login-header">
                <div class="mb-4">
                    <i class="fas fa-hotel fa-2x text-golden"></i>
                </div>
                <h1 class="text-golden">Golden Palm Hotel</h1>
                <p class="text-muted">Customer Portal</p>
            </div>

            <!-- Body -->
            <div class="login-body">
                <!-- Flash/Query alerts -->
                <div th:if="${successMessage}" class="alert-modern alert-success-modern">
                    <i class="fas fa-check-circle"></i>
                    <span th:text="${successMessage}">Success message</span>
                </div>
                <div th:if="${errorMessage}" class="alert-modern alert-error-modern">
                    <i class="fas fa-exclamation-circle"></i>
                    <span th:text="${errorMessage}">Error message</span>
                </div>
                <div th:if="${param.error}" class="alert-modern alert-error-modern">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Invalid email or password. Please try again.</span>
                </div>
                <div th:if="${param.logout}" class="alert-modern alert-success-modern">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>You have been successfully logged out.</span>
                </div>
                <div th:if="${param.registered}" class="alert-modern alert-success-modern">
                    <i class="fas fa-user-check"></i>
                    <span>Registration successful! You can now log in.</span>
                </div>

                <!-- Login Form -->
                <form th:action="@{/auth/login}" method="post" autocomplete="on">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <div class="form-floating">
                        <input type="email" id="username" name="username" class="form-control"
                               placeholder="you@example.com" required autocomplete="username">
                        <label for="username"><i class="fas fa-envelope me-2"></i>Email Address</label>
                    </div>

                    <div class="form-floating position-relative">
                        <input type="password" id="password" name="password" class="form-control"
                               placeholder="••••••••" required autocomplete="current-password">
                        <label for="password"><i class="fas fa-lock me-2"></i>Password</label>

                        <!-- show/hide eye button (only positioned element inside field) -->
                        <button type="button" class="password-toggle" aria-label="Show password" onclick="togglePassword()">
                            <i class="fas fa-eye" id="passwordToggleIcon"></i>
                        </button>
                    </div>

                    <div class="remember-me">
                        <input type="checkbox" id="remember-me" name="remember-me" value="true">
                        <label for="remember-me">Keep me signed in</label>
                    </div>

                    <button type="submit" class="login-btn">
                        <i class="fas fa-sign-in-alt me-2"></i> Sign in to your account
                    </button>

                    <div class="register-link">
                        <p>Don't have an account? <a href="/auth/register">Create one now</a></p>
                        <p class="mt-2">Hotel Staff or Admin? <a class="staff-login" href="/admin/login">Staff Login</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // eye toggle
    function togglePassword(){
        const input = document.getElementById('password');
        const icon  = document.getElementById('passwordToggleIcon');
        const isPwd = input.type === 'password';
        input.type   = isPwd ? 'text' : 'password';
        icon.className = isPwd ? 'fas fa-eye-slash' : 'fas fa-eye';
    }

    // small enter animation
    document.addEventListener('DOMContentLoaded', () => {
        const card = document.querySelector('.login-card');
        if(!card) return;
        card.style.opacity = '0';
        card.style.transform = 'translateY(40px)';
        card.style.transition = 'all .8s cubic-bezier(.4,0,.2,1)';
        requestAnimationFrame(() => {
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);
        });
    });
</script>
</body>
</html>
