<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout}">
<head>
    <title>Login - Hotel Reservation System</title>
</head>
<body>
    <div th:fragment="content">
        <div class="container">
            <div class="form-container">
                <h2 class="text-center mb-3">Welcome Back!</h2>
                <p class="text-center mb-3">Sign in to your account to continue</p>
                
                <!-- Login Error Messages -->
                <div th:if="${param.error}" class="alert alert-error">
                    <span th:if="${param.error[0] == 'bad_credentials'}">Invalid username or password. Please try again.</span>
                    <span th:if="${param.error[0] == 'disabled'}">Your account has been disabled. Please contact support.</span>
                    <span th:if="${param.error[0] == 'expired'}">Your account has expired. Please contact support.</span>
                    <span th:if="${param.error[0] == 'locked'}">Your account has been locked. Please contact support.</span>
                    <span th:unless="${param.error[0] == 'bad_credentials' or param.error[0] == 'disabled' or param.error[0] == 'expired' or param.error[0] == 'locked'}">
                        An error occurred during login. Please try again.
                    </span>
                </div>
                
                <!-- Logout Success Message -->
                <div th:if="${param.logout}" class="alert alert-success">
                    You have been successfully logged out.
                </div>
                
                <!-- Registration Success Message -->
                <div th:if="${param.registered}" class="alert alert-success">
                    Registration successful! You can now log in with your credentials.
                </div>
                
                <!-- Login Form -->
                <form th:action="@{/login}" method="post" data-validate="true">
                    <!-- CSRF Token -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    
                    <!-- Username/Email Field -->
                    <div class="form-group">
                        <label for="username">Username or Email <span style="color: red;">*</span></label>
                        <input type="text" 
                               id="username" 
                               name="username" 
                               class="form-control" 
                               placeholder="Enter your username or email"
                               th:value="${param.username != null ? param.username[0] : ''}"
                               required
                               autocomplete="username">
                    </div>
                    
                    <!-- Password Field -->
                    <div class="form-group">
                        <label for="password">Password <span style="color: red;">*</span></label>
                        <div style="position: relative;">
                            <input type="password" 
                                   id="password" 
                                   name="password" 
                                   class="form-control" 
                                   placeholder="Enter your password"
                                   required
                                   autocomplete="current-password">
                            <button type="button" 
                                    id="togglePassword" 
                                    style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #666;">
                                üëÅÔ∏è
                            </button>
                        </div>
                    </div>
                    
                    <!-- Remember Me -->
                    <div class="form-group">
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="remember-me" name="remember-me" value="true">
                            <span>Remember me on this device</span>
                        </label>
                    </div>
                    
                    <!-- Submit Button -->
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary form-control">Sign In</button>
                    </div>
                    
                    <!-- Forgot Password Link -->
                    <div class="text-center mt-2">
                        <a href="/forgot-password">Forgot your password?</a>
                    </div>
                    
                    <!-- Registration Link -->
                    <div class="text-center mt-3">
                        <p>Don't have an account? <a href="/register">Create one here</a></p>
                    </div>
                </form>
                
                <!-- Social Login (Future Enhancement) -->
                <div class="text-center mt-3" style="border-top: 1px solid #eee; padding-top: 1rem;">
                    <p style="color: #666; margin-bottom: 1rem;">Or continue with</p>
                    <div class="flex justify-center gap-2">
                        <button class="btn btn-secondary" onclick="showAlert('Google login will be available soon!', 'info')" style="background: #4285f4;">
                            üì± Google
                        </button>
                        <button class="btn btn-secondary" onclick="showAlert('Facebook login will be available soon!', 'info')" style="background: #1877f2;">
                            üìò Facebook
                        </button>
                    </div>
                </div>
                
                <!-- Quick Demo Accounts -->
                <div class="mt-3" style="border-top: 1px solid #eee; padding-top: 1rem;">
                    <p class="text-center" style="color: #666; margin-bottom: 1rem;">Quick Demo Access</p>
                    <div class="flex justify-center gap-2">
                        <button type="button" class="btn btn-secondary" onclick="fillDemoCredentials('admin')">
                            üë®‚Äçüíº Admin Demo
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="fillDemoCredentials('customer')">
                            üë§ Customer Demo
                        </button>
                    </div>
                    <p class="text-center mt-2" style="font-size: 0.8rem; color: #666;">
                        Click to auto-fill demo credentials for testing
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Additional JavaScript for login -->
    <th:block th:fragment="additional-js">
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Password visibility toggle
                const passwordField = document.getElementById('password');
                const toggleButton = document.getElementById('togglePassword');
                
                toggleButton.addEventListener('click', function() {
                    if (passwordField.type === 'password') {
                        passwordField.type = 'text';
                        this.textContent = 'üôà';
                    } else {
                        passwordField.type = 'password';
                        this.textContent = 'üëÅÔ∏è';
                    }
                });
                
                // Auto-focus on username field
                document.getElementById('username').focus();
                
                // Handle Enter key in form fields
                const formFields = document.querySelectorAll('input');
                formFields.forEach((field, index) => {
                    field.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            if (index < formFields.length - 1) {
                                // Move to next field
                                formFields[index + 1].focus();
                            } else {
                                // Submit form
                                document.querySelector('form').submit();
                            }
                        }
                    });
                });
                
                // Clear any existing error styling on input
                const inputs = document.querySelectorAll('input');
                inputs.forEach(input => {
                    input.addEventListener('input', function() {
                        this.classList.remove('error');
                    });
                });
            });
            
            // Demo account credentials
            function fillDemoCredentials(type) {
                const usernameField = document.getElementById('username');
                const passwordField = document.getElementById('password');
                
                if (type === 'admin') {
                    usernameField.value = 'admin';
                    passwordField.value = 'password';
                    showAlert('Admin demo credentials filled. Click Sign In to continue.', 'info');
                } else if (type === 'customer') {
                    usernameField.value = 'john_doe';
                    passwordField.value = 'password';
                    showAlert('Customer demo credentials filled. Click Sign In to continue.', 'info');
                }
                
                // Focus on the submit button
                document.querySelector('button[type="submit"]').focus();
            }
            
            // Show loading state on form submission
            document.querySelector('form').addEventListener('submit', function() {
                const submitButton = this.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.innerHTML = '<div class="spinner" style="width: 20px; height: 20px; margin: 0 auto;"></div>';
                
                // Re-enable button after 5 seconds (in case of network issues)
                setTimeout(() => {
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Sign In';
                }, 5000);
            });
        </script>
    </th:block>
</body>
</html>