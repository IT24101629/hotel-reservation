<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" th:replace="~{layout :: layout(~{::title}, ~{::content})}">
<head>
    <title>Special Offers & Promotions - Golden Palm Hotel</title>
</head>
<body>
<div th:fragment="content">
    <!-- Hero Section -->
    <section class="hero-section bg-dark">
        <div class="container">
            <div class="text-center">
                <div class="fade-in-up">
                    <h1 class="display-4 mb-6 text-golden">
                        <i class="fas fa-tags me-3"></i>
                        Special Offers & Promotions
                    </h1>
                </div>
                <div class="fade-in-up" style="animation-delay: 0.2s;">
                    <p class="lead mb-8">
                        Discover our exclusive deals and save on your next stay at Golden Palm Hotel
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Promotions Section -->
    <section class="py-5" th:if="${promotions != null and !#lists.isEmpty(promotions)}">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-6 col-xl-4" th:each="promotion : ${promotions}">
                    <div class="card h-100 shadow-glow fade-in-up">
                        <!-- Promotion Image -->
                        <div class="position-relative">
                            <img th:src="${promotion.imagePath != null and !#strings.isEmpty(promotion.imagePath) ? promotion.imagePath : '/images/room-default.jpg'}"
                                 th:alt="${promotion.promoCode}"
                                 class="card-img-top"
                                 style="height: 250px; object-fit: cover;"
                                 onerror="this.src='/images/room-default.jpg'">

                            <!-- Discount Badge -->
                            <div class="position-absolute top-0 end-0 m-3">
                                <span class="badge bg-danger fs-5 px-3 py-2" th:if="${promotion.discountType.name() == 'PERCENTAGE'}">
                                    <i class="fas fa-percent me-1"></i>
                                    <span th:text="${promotion.discountValue} + '% OFF'">20% OFF</span>
                                </span>
                                <span class="badge bg-danger fs-5 px-3 py-2" th:if="${promotion.discountType.name() == 'FIXED_AMOUNT'}">
                                    <i class="fas fa-tag me-1"></i>
                                    <span th:text="'LKR ' + ${#numbers.formatDecimal(promotion.discountValue, 1, 2)} + ' OFF'">LKR 5000 OFF</span>
                                </span>
                            </div>

                            <!-- Status Badge (Upcoming/Expired) -->
                            <div class="position-absolute top-0 start-0 m-3">
                                <span class="badge bg-info" th:if="${#temporals.createNow().isBefore(promotion.startDate)}">
                                    <i class="fas fa-clock me-1"></i>Coming Soon
                                </span>
                                <span class="badge bg-secondary" th:if="${#temporals.createNow().isAfter(promotion.endDate)}">
                                    <i class="fas fa-times-circle me-1"></i>Expired
                                </span>
                            </div>
                        </div>

                        <div class="card-body">
                            <h4 class="card-title text-golden mb-3">
                                <i class="fas fa-gift me-2"></i>
                                <span th:text="${promotion.title}">Special Holiday Offer</span>
                            </h4>

                            <!-- Description -->
                            <p class="card-text mb-3" th:if="${promotion.description != null and !#strings.isEmpty(promotion.description)}"
                               th:text="${#strings.length(promotion.description) > 100 ? #strings.substring(promotion.description, 0, 100) + '...' : promotion.description}">
                                Limited time offer for all rooms
                            </p>

                            <!-- Promo Code -->
                            <div class="mb-3 p-3 bg-gradient-card rounded border-gradient">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <small class="text-muted d-block">Promo Code</small>
                                        <h5 class="mb-0 text-golden" th:text="${promotion.promoCode}">SUMMER2025</h5>
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary"
                                            th:data-promo-code="${promotion.promoCode}"
                                            onclick="copyPromoCode(this.getAttribute('data-promo-code'))">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                            </div>

                            <!-- Validity Period -->
                            <div class="mb-3">
                                <p class="mb-2">
                                    <i class="fas fa-calendar-alt text-golden me-2"></i>
                                    <strong>Valid From:</strong>
                                    <span th:text="${#temporals.format(promotion.startDate, 'MMM dd, yyyy')}">Jan 01, 2025</span>
                                </p>
                                <p class="mb-0">
                                    <i class="fas fa-calendar-times text-golden me-2"></i>
                                    <strong>Valid Until:</strong>
                                    <span th:text="${#temporals.format(promotion.endDate, 'MMM dd, yyyy')}">Mar 31, 2025</span>
                                </p>
                            </div>

                            <!-- Usage Stats -->
                            <div class="mb-3" th:if="${promotion.usageLimit != null}">
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-golden"
                                         th:style="'width: ' + ${(promotion.usageCount * 100.0 / promotion.usageLimit)} + '%'"
                                         th:text="${promotion.usageCount} + ' / ' + ${promotion.usageLimit} + ' used'">
                                        10 / 100 used
                                    </div>
                                </div>
                            </div>

                            <!-- Terms Preview -->
                            <div th:if="${promotion.termsConditions != null and !#strings.isEmpty(promotion.termsConditions)}">
                                <p class="small text-muted mb-0">
                                    <i class="fas fa-info-circle me-1"></i>
                                    <span th:text="${#strings.length(promotion.termsConditions) > 80 ? #strings.substring(promotion.termsConditions, 0, 80) + '...' : promotion.termsConditions}">
                                        Terms and conditions apply...
                                    </span>
                                </p>
                            </div>
                        </div>

                        <div class="card-footer">
                            <a href="/rooms" class="btn btn-primary w-100">
                                <i class="fas fa-bed me-2"></i>Book Now with This Offer
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- No Promotions Message -->
    <section class="py-5" th:if="${promotions == null or #lists.isEmpty(promotions)}">
        <div class="container">
            <div class="text-center">
                <div class="card shadow-glow">
                    <div class="card-body p-5">
                        <div class="mb-4">
                            <i class="fas fa-tags text-golden display-1"></i>
                        </div>
                        <h3 class="text-golden mb-3">No Active Promotions</h3>
                        <p class="lead mb-4">
                            There are no active promotions at the moment. Check back soon for exciting deals!
                        </p>
                        <a href="/rooms" class="btn btn-primary">
                            <i class="fas fa-bed me-2"></i>Browse Available Rooms
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="py-5" th:if="${promotions != null and !#lists.isEmpty(promotions)}">
        <div class="container">
            <div class="card shadow-glow bg-gradient text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body p-5 text-center">
                    <h2 class="mb-3">
                        <i class="fas fa-gift me-2"></i>Ready to Save?
                    </h2>
                    <p class="lead mb-4">
                        Use any of our promo codes during booking to get instant discounts on your stay!
                    </p>
                    <div class="d-flex gap-3 justify-content-center flex-wrap">
                        <a href="/rooms" class="btn btn-primary btn-lg">
                            <i class="fas fa-bed me-2"></i>Browse Rooms
                        </a>
                        <a href="/my-bookings" class="btn btn-outline-light btn-lg" sec:authorize="isAuthenticated()">
                            <i class="fas fa-calendar-check me-2"></i>My Bookings
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        function copyPromoCode(promoCode) {
            navigator.clipboard.writeText(promoCode).then(() => {
                // Show success feedback
                const button = event.target.closest('button');
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                button.classList.remove('btn-outline-primary');
                button.classList.add('btn-success');

                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('btn-success');
                    button.classList.add('btn-outline-primary');
                }, 2000);
            }).catch(err => {
                alert('Failed to copy promo code. Please copy it manually: ' + promoCode);
            });
        }
    </script>
</div>
</body>
</html>
