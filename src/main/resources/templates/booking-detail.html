<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" th:replace="~{layout :: layout(~{::title}, ~{::content})}">
<head>
    <title>Booking Details - Golden Palm Hotel</title>
</head>
<body>
<div th:fragment="content">
    <!-- Hero Section -->
    <section class="hero-section bg-dark">
        <div class="container">
            <div class="text-center">
                <div class="fade-in-up">
                    <h1 class="display-4 mb-6 text-golden">
                        <i class="fas fa-receipt me-3"></i>
                        Booking Details
                    </h1>
                </div>
                <div class="fade-in-up" style="animation-delay: 0.2s;">
                    <p class="lead mb-8">
                        Complete reservation information and management at Golden Palm Hotel
                    </p>
                    <div th:if="${booking != null}" class="d-inline-block">
                        <span class="badge bg-golden text-dark fs-6 px-4 py-2">
                            <i class="fas fa-hashtag me-2"></i>Booking Reference: <span th:text="${booking.bookingReference}">BK123456</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Navigation -->
    <section class="py-3">
        <div class="container">
            <a href="/my-bookings" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to My Bookings
            </a>
        </div>
    </section>

    <!-- Main Content -->
    <section class="py-5" th:if="${booking != null}">
        <div class="container">
            <div class="row g-4">
                <!-- Left Column - Booking Information -->
                <div class="col-lg-8">
                    <!-- Booking Status Card -->
                    <div class="card shadow-glow mb-4">
                        <div class="card-header">
                            <h2 class="mb-0">
                                <i class="fas fa-info-circle text-golden me-3"></i>
                                Reservation Status
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="text-center p-3 border rounded">
                                        <h6 class="mb-2">Booking Status</h6>
                                        <span class="badge bg-success" th:if="${booking.bookingStatus.name() == 'CONFIRMED'}">
                                            <i class="fas fa-check-circle me-1"></i>CONFIRMED
                                        </span>
                                        <span class="badge bg-warning" th:if="${booking.bookingStatus.name() == 'PENDING'}">
                                            <i class="fas fa-clock me-1"></i>PENDING
                                        </span>
                                        <span class="badge bg-danger" th:if="${booking.bookingStatus.name() == 'CANCELLED'}">
                                            <i class="fas fa-times-circle me-1"></i>CANCELLED
                                        </span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="text-center p-3 border rounded">
                                        <h6 class="mb-2">Payment Status</h6>
                                        <span class="badge bg-success" th:if="${booking.paymentStatus.name() == 'PAID'}">
                                            <i class="fas fa-check-circle me-1"></i>PAID
                                        </span>
                                        <span class="badge bg-warning" th:if="${booking.paymentStatus.name() == 'PENDING'}">
                                            <i class="fas fa-clock me-1"></i>PENDING
                                        </span>
                                        <span class="badge bg-danger" th:if="${booking.paymentStatus.name() == 'FAILED'}">
                                            <i class="fas fa-exclamation-circle me-1"></i>FAILED
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Room Information Card -->
                    <div class="card shadow-glow mb-4">
                        <div class="card-header">
                            <h2 class="mb-0">
                                <i class="fas fa-bed text-golden me-3"></i>
                                Room Information
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="row g-4">
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center p-3 border rounded">
                                        <div class="me-3">
                                            <i class="fas fa-door-open text-golden fs-4"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-1">Room Number</h6>
                                            <p class="mb-0 fw-bold" th:text="${booking.roomNumber}">101</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center p-3 border rounded">
                                        <div class="me-3">
                                            <i class="fas fa-bed text-golden fs-4"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-1">Room Type</h6>
                                            <p class="mb-0 fw-bold" th:text="${booking.roomType}">Deluxe Room</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center p-3 border rounded">
                                        <div class="me-3">
                                            <i class="fas fa-users text-golden fs-4"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-1">Guests</h6>
                                            <p class="mb-0 fw-bold" th:text="${booking.numberOfGuests}">2</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stay Information Card -->
                    <div class="card shadow-glow mb-4">
                        <div class="card-header">
                            <h2 class="mb-0">
                                <i class="fas fa-calendar-alt text-golden me-3"></i>
                                Stay Information
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="row g-4 mb-4">
                                <div class="col-md-6">
                                    <div class="text-center p-4 border rounded">
                                        <div class="mb-3">
                                            <i class="fas fa-sign-in-alt text-success display-6"></i>
                                        </div>
                                        <h5 class="text-success">Check-in</h5>
                                        <p class="mb-1 fw-bold" th:text="${#temporals.format(booking.checkInDate, 'EEEE, MMM dd, yyyy')}">Monday, Jan 15, 2025</p>
                                        <small class="text-muted">2:00 PM</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="text-center p-4 border rounded">
                                        <div class="mb-3">
                                            <i class="fas fa-sign-out-alt text-danger display-6"></i>
                                        </div>
                                        <h5 class="text-danger">Check-out</h5>
                                        <p class="mb-1 fw-bold" th:text="${#temporals.format(booking.checkOutDate, 'EEEE, MMM dd, yyyy')}">Thursday, Jan 18, 2025</p>
                                        <small class="text-muted">11:00 AM</small>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="text-center p-3 bg-gradient-card rounded border-gradient">
                                        <i class="fas fa-moon text-golden me-2"></i>
                                        <span th:text="${booking.numberOfNights} + ' Night' + (${booking.numberOfNights} > 1 ? 's' : '')">3 Nights</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="text-center p-3 bg-gradient-card rounded border-gradient">
                                        <i class="fas fa-calendar text-golden me-2"></i>
                                        <span>Booked on <span th:text="${#temporals.format(booking.createdAt, 'MMM dd, yyyy')}">Jan 10, 2025</span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Information Card -->
                    <div class="card shadow-glow mb-4">
                        <div class="card-header">
                            <h2 class="mb-0">
                                <i class="fas fa-user text-golden me-3"></i>
                                Customer Information
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="d-flex align-items-center p-3 border rounded mb-4">
                                <div class="me-3">
                                    <i class="fas fa-envelope text-golden fs-4"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1">Email Address</h6>
                                    <p class="mb-0 fw-bold" th:text="${booking.customerEmail}">customer@example.com</p>
                                </div>
                            </div>
                            
                            <div th:if="${booking.specialRequests != null and !#strings.isEmpty(booking.specialRequests)}" class="mb-3">
                                <div class="alert alert-info">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-sticky-note me-2"></i>Special Requests
                                    </h6>
                                    <p class="mb-0" th:text="${booking.specialRequests}">Late check-in requested</p>
                                </div>
                            </div>
                            
                            <div th:if="${booking.customerNotes != null and !#strings.isEmpty(booking.customerNotes)}">
                                <div class="alert alert-secondary">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-comment me-2"></i>Customer Notes
                                    </h6>
                                    <p class="mb-0" th:text="${booking.customerNotes}">Customer notes</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Payment Summary & Actions -->
                <div class="col-lg-4">
                    <!-- Payment Summary Card -->
                    <div class="card shadow-glow mb-4">
                        <div class="card-header">
                            <h2 class="mb-0">
                                <i class="fas fa-credit-card text-golden me-3"></i>
                                Payment Summary
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div>
                                    <h6 class="mb-1">Room Rate</h6>
                                    <small class="text-muted" th:text="'× ' + ${booking.numberOfNights} + ' night' + (${booking.numberOfNights} > 1 ? 's' : '')">× 3 nights</small>
                                </div>
                                <span class="fw-bold" th:text="'LKR ' + ${#numbers.formatDecimal(booking.totalAmount, 1, 2)}">LKR 54,000.00</span>
                            </div>
                            <hr class="my-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Total Amount</h5>
                                <h4 class="mb-0 text-golden" th:text="'LKR ' + ${#numbers.formatDecimal(booking.totalAmount, 1, 2)}">LKR 54,000.00</h4>
                            </div>
                        </div>
                    </div>

                    <!-- QR Code Card -->
                            <div class="card shadow-glow mb-4" th:if="${booking.bookingStatus.name() == 'CONFIRMED'}">
                        <div class="card-header text-center">
                            <h2 class="mb-0">
                                <i class="fas fa-qrcode text-golden me-3"></i>
                                Digital Check-in
                            </h2>
                        </div>
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="fas fa-mobile-alt text-golden display-6"></i>
                            </div>
                            <h5 class="mb-3">Show at Reception</h5>
                            <div class="border rounded p-4 bg-gradient-card border-gradient">
                                <i class="fas fa-qrcode display-1 text-golden mb-3"></i>
                                <p class="small mb-0">QR Code Available for Confirmed Bookings</p>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons Card -->
                    <div class="card shadow-glow mb-4">
                        <div class="card-header">
                            <h2 class="mb-0">
                                <i class="fas fa-cogs text-golden me-3"></i>
                                Actions
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-3">
                                <a th:if="${booking.paymentStatus.name() == 'PENDING'}"
                                   th:href="@{'/payment?bookingId=' + ${booking.bookingId}}"
                                   class="btn btn-primary">
                                    <i class="fas fa-credit-card me-2"></i>Complete Payment
                                </a>
                                
                                <a th:if="${booking.bookingStatus.name() == 'CONFIRMED' or booking.bookingStatus.name() == 'PENDING'}"
                                   th:href="@{'/booking/' + ${booking.bookingId} + '/edit'}"
                                   class="btn btn-outline-warning">
                                    <i class="fas fa-edit me-2"></i>Edit Booking
                                </a>
                                
                                <button th:if="${booking.bookingStatus.name() == 'CONFIRMED' or booking.bookingStatus.name() == 'PENDING'}"
                                        class="btn btn-outline-danger"
                                        th:onclick="'cancelBooking(' + ${booking.bookingId} + ')'">
                                    <i class="fas fa-times me-2"></i>Cancel Booking
                                </button>
                                
                                <button class="btn btn-outline-secondary" onclick="window.print()">
                                    <i class="fas fa-print me-2"></i>Print Details
                                </button>
                                
                                <a href="/my-bookings" class="btn btn-secondary">
                                    <i class="fas fa-list me-2"></i>All Bookings
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Important Information Card -->
                    <div class="card shadow-glow">
                        <div class="card-header">
                            <h2 class="mb-0">
                                <i class="fas fa-exclamation-circle text-golden me-3"></i>
                                Important Information
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="alert alert-info">
                                    <i class="fas fa-clock me-2"></i>
                                    <strong>Check-in:</strong> 2:00 PM<br>
                                    <strong>Check-out:</strong> 11:00 AM
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="alert alert-warning">
                                    <i class="fas fa-ban me-2"></i>
                                    <strong>Cancellation:</strong><br>
                                    Free up to 24 hours before check-in
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="alert alert-secondary">
                                    <i class="fas fa-id-card me-2"></i>
                                    <strong>ID Required:</strong><br>
                                    Valid government-issued photo ID
                                </div>
                            </div>
                            <div class="alert alert-primary">
                                <i class="fas fa-phone me-2"></i>
                                <strong>Contact:</strong><br>
                                +94 11 1234567<br>
                                support@goldpalmhotel.com
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Additional JavaScript -->
<th:block th:fragment="additional-js">
    <script>
        function cancelBooking(bookingId) {
            if (confirm('Are you sure you want to cancel this booking? This action cannot be undone and a cancellation email will be sent.')) {
                console.log('Cancelling booking:', bookingId);
                
                fetch('/api/bookings/' + bookingId + '/cancel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]')?.getAttribute('content') || ''
                    },
                    body: JSON.stringify({
                        reason: 'Cancelled by customer'
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.href = '/my-bookings';
                    } else {
                        alert('❌ Error cancelling booking: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('❌ Error cancelling booking. Please try again.');
                });
            }
        }
    </script>
</th:block>
</body>
</html>