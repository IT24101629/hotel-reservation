<!DOCTYPE html>
<html>
<head>
    <title>PayHere Minimal Test</title>
</head>
<body>
    <h1>PayHere Minimal Test</h1>
    
    <div>
        <p><strong>Minimal Test - Only Required Fields:</strong></p>
        <ul>
            <li>Merchant ID: 1221688</li>
            <li>Order ID: MIN-TEST-123</li>
            <li>Amount: 10.00 LKR (back to LKR for testing)</li>
            <li>Currency: LKR</li>
        </ul>
    </div>
    
    <!-- Test 1: LKR Currency -->
    <h3>Test 1: LKR Currency</h3>
    <form method="post" action="https://sandbox.payhere.lk/pay/checkout">
        <input type="hidden" name="merchant_id" value="1221688">
        <input type="hidden" name="return_url" value="http://localhost:8080/payment/success">
        <input type="hidden" name="cancel_url" value="http://localhost:8080/payment/cancel">
        <input type="hidden" name="notify_url" value="http://localhost:8080/api/payment/payhere/notify">
        <input type="hidden" name="order_id" value="MIN-TEST-LKR-123">
        <input type="hidden" name="items" value="Test Item">
        <input type="hidden" name="currency" value="LKR">
        <input type="hidden" name="amount" value="10.00">
        <input type="hidden" name="first_name" value="Test">
        <input type="hidden" name="last_name" value="User">
        <input type="hidden" name="email" value="test@example.com">
        <input type="hidden" name="phone" value="+94771234567">
        <input type="hidden" name="address" value="Test Address">
        <input type="hidden" name="city" value="Colombo">
        <input type="hidden" name="country" value="Sri Lanka">
        <!-- Hash for LKR: MD5(1221688 + MIN-TEST-LKR-123 + 10.00 + LKR + MD5(NDEwMjkxMjMxNTMxODkxNzQzNjMyNTI5MjgxMDkzMzgwMjY4MjY0MQ==)) -->
        <input type="hidden" name="hash" value="E5A33C645F1C9F22B5E4B1C5D7A9E7A4">
        <button type="submit">Test LKR Payment</button>
    </form>
    
    <br><br>
    
    <!-- Test 2: USD Currency -->
    <h3>Test 2: USD Currency</h3>
    <form method="post" action="https://sandbox.payhere.lk/pay/checkout">
        <input type="hidden" name="merchant_id" value="1221688">
        <input type="hidden" name="return_url" value="http://localhost:8080/payment/success">
        <input type="hidden" name="cancel_url" value="http://localhost:8080/payment/cancel">
        <input type="hidden" name="notify_url" value="http://localhost:8080/api/payment/payhere/notify">
        <input type="hidden" name="order_id" value="MIN-TEST-USD-123">
        <input type="hidden" name="items" value="Test Item">
        <input type="hidden" name="currency" value="USD">
        <input type="hidden" name="amount" value="10.00">
        <input type="hidden" name="first_name" value="Test">
        <input type="hidden" name="last_name" value="User">
        <input type="hidden" name="email" value="test@example.com">
        <input type="hidden" name="phone" value="+94771234567">
        <input type="hidden" name="address" value="Test Address">
        <input type="hidden" name="city" value="Colombo">
        <input type="hidden" name="country" value="Sri Lanka">
        <!-- Hash for USD: MD5(1221688 + MIN-TEST-USD-123 + 10.00 + USD + MD5(NDEwMjkxMjMxNTMxODkxNzQzNjMyNTI5MjgxMDkzMzgwMjY4MjY0MQ==)) -->
        <input type="hidden" name="hash" value="B2C4D6E8F0A1B3C5D7E9F1A2B4C6D8E0">
        <button type="submit">Test USD Payment</button>
    </form>
    
    <br><br>
    
    <!-- Test 3: Dynamic Hash Calculation -->
    <h3>Test 3: Dynamic Hash (LKR)</h3>
    <form id="dynamic-form" method="post" action="https://sandbox.payhere.lk/pay/checkout">
        <input type="hidden" name="merchant_id" value="1221688">
        <input type="hidden" name="return_url" value="http://localhost:8080/payment/success">
        <input type="hidden" name="cancel_url" value="http://localhost:8080/payment/cancel">
        <input type="hidden" name="notify_url" value="http://localhost:8080/api/payment/payhere/notify">
        <input type="hidden" name="order_id" value="DYN-TEST-123">
        <input type="hidden" name="items" value="Dynamic Test">
        <input type="hidden" name="currency" value="LKR">
        <input type="hidden" name="amount" value="15.00">
        <input type="hidden" name="first_name" value="Dynamic">
        <input type="hidden" name="last_name" value="Test">
        <input type="hidden" name="email" value="dynamic@example.com">
        <input type="hidden" name="phone" value="+94771234567">
        <input type="hidden" name="address" value="Test Address">
        <input type="hidden" name="city" value="Colombo">
        <input type="hidden" name="country" value="Sri Lanka">
        <input type="hidden" name="hash" id="dynamic-hash" value="">
        <button type="button" onclick="calculateAndSubmit()">Calculate Hash & Submit</button>
    </form>
    
    <div id="debug-info" style="margin-top: 20px; padding: 10px; background: #f5f5f5; border: 1px solid #ccc;">
        <h4>Debug Information:</h4>
        <div id="debug-content">Click "Calculate Hash & Submit" to see debug info</div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        function calculateAndSubmit() {
            const merchantId = '1221688';
            const orderId = 'DYN-TEST-123';
            const amount = '15.00';
            const currency = 'LKR';
            const merchantSecret = 'NDEwMjkxMjMxNTMxODkxNzQzNjMyNTI5MjgxMDkzMzgwMjY4MjY0MQ==';
            
            console.log('=== PayHere Hash Calculation Debug ===');
            console.log('Merchant ID:', merchantId);
            console.log('Order ID:', orderId);
            console.log('Amount:', amount);
            console.log('Currency:', currency);
            console.log('Merchant Secret:', merchantSecret);
            
            // Step 1: Calculate MD5 of merchant secret
            const secretHash = CryptoJS.MD5(merchantSecret).toString().toLowerCase();
            console.log('Secret Hash (MD5):', secretHash);
            
            // Step 2: Create hash string
            const hashString = merchantId + orderId + amount + currency + secretHash;
            console.log('Hash String:', hashString);
            
            // Step 3: Calculate final hash
            const finalHash = CryptoJS.MD5(hashString).toString().toUpperCase();
            console.log('Final Hash:', finalHash);
            
            document.getElementById('dynamic-hash').value = finalHash;
            
            // Display debug info
            const debugContent = `
                <strong>Hash Calculation Steps:</strong><br>
                1. Merchant Secret: ${merchantSecret}<br>
                2. Secret MD5: ${secretHash}<br>
                3. Hash String: ${hashString}<br>
                4. Final Hash: ${finalHash}<br>
                <br>
                <strong>Form Data Being Sent:</strong><br>
                - merchant_id: ${merchantId}<br>
                - order_id: ${orderId}<br>
                - amount: ${amount}<br>
                - currency: ${currency}<br>
                - hash: ${finalHash}
            `;
            document.getElementById('debug-content').innerHTML = debugContent;
            
            // Submit after showing debug info
            setTimeout(() => {
                console.log('Submitting form to PayHere...');
                document.getElementById('dynamic-form').submit();
            }, 2000);
        }
    </script>
</body>
</html>